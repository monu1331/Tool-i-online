<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stopwatch & Countdown — Tool i online</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{ --orange:#FB8C00; --orange-dark:#e67a00; --bg:#fff; --muted:#666; --radius:12px; --shadow:0 12px 30px rgba(0,0,0,0.06); --container:980px }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,#fff,#fcfcfc);color:#222;padding:20px}
    .wrap{max-width:var(--container);margin:0 auto}
    header{display:flex;gap:12px;align-items:center;margin-bottom:16px}
    .logo{width:56px;height:56px;border-radius:12px;background:var(--orange);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;box-shadow:var(--shadow)}
    h1{margin:0;font-size:20px}
    .lead{color:var(--muted);font-size:14px;margin-top:4px}

    .card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px;align-items:start}

    .section-title{font-weight:700;margin-bottom:8px}
    .display{font-family:monospace;font-size:48px;font-weight:800;text-align:center}
    .small{font-size:13px;color:var(--muted)}

    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--orange);color:#fff}
    .btn.ghost{background:#fff;border:1px solid #eee}
    .btn.danger{background:#d32f2f;color:#fff}

    .timer-inputs{display:flex;gap:8px;justify-content:center;align-items:center}
    input[type=number]{width:80px;padding:10px;border-radius:10px;border:1px solid #eee;text-align:center}

    .laps{max-height:240px;overflow:auto;padding:8px;border-radius:8px;border:1px solid #f0f0f0}
    .lap{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed #f4f4f4}

    .progress-wrap{height:12px;width:100%;background:#f3f3f3;border-radius:8px;overflow:hidden}
    .progress{height:100%;background:linear-gradient(90deg,var(--orange),var(--orange-dark));width:0%}

    @media(max-width:860px){ .grid{grid-template-columns:1fr} .display{font-size:36px} input[type=number]{width:60px} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">Ti</div>
      <div>
        <h1>Stopwatch & Countdown</h1>
        <div class="lead">Dual tool: precision stopwatch with laps and a flexible countdown timer. Orange theme, responsive, client-side.</div>
      </div>
    </header>

    <main class="card">
      <div class="grid">
        <section>
          <div>
            <div class="section-title">Stopwatch</div>
            <div id="swDisplay" class="display">00:00:00.000</div>
            <div class="controls">
              <button id="swStart" class="btn primary"><i class="fa-solid fa-play"></i> Start</button>
              <button id="swPause" class="btn ghost" disabled><i class="fa-solid fa-pause"></i> Pause</button>
              <button id="swLap" class="btn ghost" disabled><i class="fa-solid fa-flag"></i> Lap</button>
              <button id="swReset" class="btn ghost" disabled><i class="fa-solid fa-rotate-left"></i> Reset</button>
            </div>

            <div style="margin-top:12px">
              <div class="small">Laps</div>
              <div id="laps" class="laps"></div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button id="clearLaps" class="btn ghost" disabled>Clear Laps</button>
                <button id="exportLaps" class="btn ghost" disabled>Export (CSV)</button>
              </div>
            </div>
          </div>
        </section>

        <aside>
          <div>
            <div class="section-title">Countdown Timer</div>
            <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
              <div class="timer-inputs">
                <div>
                  <label class="small">Hours</label>
                  <input id="tHours" type="number" min="0" value="0">
                </div>
                <div>
                  <label class="small">Minutes</label>
                  <input id="tMinutes" type="number" min="0" max="59" value="1">
                </div>
                <div>
                  <label class="small">Seconds</label>
                  <input id="tSeconds" type="number" min="0" max="59" value="0">
                </div>
              </div>

              <div id="cdDisplay" class="display">00:01:00</div>

              <div class="controls">
                <button id="cdStart" class="btn primary"><i class="fa-solid fa-play"></i> Start</button>
                <button id="cdPause" class="btn ghost" disabled><i class="fa-solid fa-pause"></i> Pause</button>
                <button id="cdReset" class="btn ghost" disabled><i class="fa-solid fa-rotate-left"></i> Reset</button>
              </div>

              <div style="width:100%;margin-top:12px">
                <div class="small">Progress</div>
                <div class="progress-wrap"><div id="cdProgress" class="progress"></div></div>
              </div>

              <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
                <button id="cdPreset1" class="btn ghost">1m</button>
                <button id="cdPreset2" class="btn ghost">5m</button>
                <button id="cdPreset3" class="btn ghost">10m</button>
                <button id="cdPreset4" class="btn ghost">30m</button>
              </div>

              <div style="margin-top:10px;display:flex;gap:8px">
                <label class="small" style="display:flex;align-items:center;gap:8px"><input id="soundToggle" type="checkbox" checked> Alarm sound</label>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <audio id="alarmSound" src="" preload="auto"></audio>

  <script>
    // Stopwatch
    const swDisplay = document.getElementById('swDisplay');
    const swStart = document.getElementById('swStart');
    const swPause = document.getElementById('swPause');
    const swLap = document.getElementById('swLap');
    const swReset = document.getElementById('swReset');
    const lapsEl = document.getElementById('laps');
    const clearLaps = document.getElementById('clearLaps');
    const exportLaps = document.getElementById('exportLaps');

    let swRunning = false; let swStartTime = 0; let swElapsed = 0; let swTimerId = null; let lapTimes = [];

    function fmtTime(ms, showMs = true){ const total = Math.max(0, ms); const h = Math.floor(total/3600000); const m = Math.floor((total%3600000)/60000); const s = Math.floor((total%60000)/1000); const msPart = total%1000; if(showMs) return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}.${String(msPart).padStart(3,'0')}`; return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }

    function updateSwDisplay(){ const now = performance.now(); const current = swElapsed + (swRunning ? (now - swStartTime) : 0); swDisplay.textContent = fmtTime(Math.round(current)); }

    function swTick(){ updateSwDisplay(); swTimerId = requestAnimationFrame(swTick); }

    swStart.addEventListener('click', ()=>{
      if(!swRunning){ swRunning = true; swStartTime = performance.now(); swTimerId = requestAnimationFrame(swTick); swStart.disabled = true; swPause.disabled = false; swLap.disabled = false; swReset.disabled = false; }
    });

    swPause.addEventListener('click', ()=>{
      if(swRunning){ swRunning = false; swElapsed += performance.now() - swStartTime; cancelAnimationFrame(swTimerId); swStart.disabled = false; swPause.disabled = true; }
    });

    swLap.addEventListener('click', ()=>{
      const nowElapsed = Math.round(swElapsed + (swRunning ? (performance.now() - swStartTime) : 0)); lapTimes.push(nowElapsed); renderLaps(); clearLaps.disabled = false; exportLaps.disabled = false; });

    swReset.addEventListener('click', ()=>{
      swRunning = false; swElapsed = 0; lapTimes = []; cancelAnimationFrame(swTimerId); updateSwDisplay(); swStart.disabled = false; swPause.disabled = true; swLap.disabled = true; swReset.disabled = true; clearLaps.disabled = true; exportLaps.disabled = true; renderLaps(); });

    function renderLaps(){ lapsEl.innerHTML = ''; lapTimes.forEach((t,i)=>{ const div = document.createElement('div'); div.className='lap'; div.innerHTML = `<div>Lap ${i+1}</div><div>${fmtTime(t)}</div>`; lapsEl.appendChild(div); }); }

    clearLaps.addEventListener('click', ()=>{ lapTimes = []; renderLaps(); clearLaps.disabled = true; exportLaps.disabled = true; });

    exportLaps.addEventListener('click', ()=>{ const txt = lapTimes.map((t,i)=>`Lap ${i+1},${t}`).join('\n'); const blob = new Blob([txt], {type:'text/csv'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'laps.csv'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),5000); });

    // Initialize display
    updateSwDisplay();

    // Countdown
    const tHours = document.getElementById('tHours');
    const tMinutes = document.getElementById('tMinutes');
    const tSeconds = document.getElementById('tSeconds');
    const cdDisplay = document.getElementById('cdDisplay');
    const cdStart = document.getElementById('cdStart');
    const cdPause = document.getElementById('cdPause');
    const cdReset = document.getElementById('cdReset');
    const cdProgress = document.getElementById('cdProgress');
    const cdPreset1 = document.getElementById('cdPreset1');
    const cdPreset2 = document.getElementById('cdPreset2');
    const cdPreset3 = document.getElementById('cdPreset3');
    const cdPreset4 = document.getElementById('cdPreset4');
    const soundToggle = document.getElementById('soundToggle');
    const alarmSound = document.getElementById('alarmSound');

    // small built-in beep (data URL) — short tone
    alarmSound.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA='; // silent placeholder; browsers often block auto-play; user toggle recommended

    let cdTotal = 60000; let cdRemaining = cdTotal; let cdRunning = false; let cdStartTs = 0; let cdTimerId = null;

    function updateCdDisplay(){ const ms = Math.max(0, Math.round(cdRemaining - (cdRunning ? (performance.now() - cdStartTs) : 0))); const h = Math.floor(ms/3600000); const m = Math.floor((ms%3600000)/60000); const s = Math.floor((ms%60000)/1000); cdDisplay.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; const pct = ((cdTotal - ms) / cdTotal) * 100; cdProgress.style.width = `${Math.min(100, Math.max(0, pct))}%`; }

    function cdTick(){ updateCdDisplay(); if(cdRunning){ const msLeft = cdRemaining - (performance.now() - cdStartTs); if(msLeft <= 0){ // finished
        cdRunning = false; cancelAnimationFrame(cdTimerId); cdRemaining = 0; updateCdDisplay(); cdStart.disabled = false; cdPause.disabled = true; cdReset.disabled = false; if(soundToggle.checked){ try{ alarmSound.currentTime = 0; alarmSound.play(); }catch(e){} } return; } cdTimerId = requestAnimationFrame(cdTick); } }

    function setCdFromInputs(){ const h = Math.max(0, Number(tHours.value)||0); const m = Math.max(0, Number(tMinutes.value)||0); const s = Math.max(0, Number(tSeconds.value)||0); cdTotal = (h*3600 + m*60 + s)*1000; cdRemaining = cdTotal; updateCdDisplay(); }

    cdStart.addEventListener('click', ()=>{ setCdFromInputs(); if(cdTotal <= 0) return alert('Set a duration first'); if(!cdRunning){ cdRunning = true; cdStartTs = performance.now(); cdStart.disabled = true; cdPause.disabled = false; cdReset.disabled = false; cdTimerId = requestAnimationFrame(cdTick); } });
    cdPause.addEventListener('click', ()=>{ if(cdRunning){ cdRunning = false; cdRemaining = Math.max(0, cdRemaining - (performance.now() - cdStartTs)); cancelAnimationFrame(cdTimerId); cdStart.disabled = false; cdPause.disabled = true; } });
    cdReset.addEventListener('click', ()=>{ cdRunning = false; setCdFromInputs(); cancelAnimationFrame(cdTimerId); cdStart.disabled = false; cdPause.disabled = true; cdReset.disabled = true; cdProgress.style.width = '0%'; });

    [tHours,tMinutes,tSeconds].forEach(inp=> inp.addEventListener('change', ()=>{ setCdFromInputs(); cdReset.disabled = true; }));

    [cdPreset1, cdPreset2, cdPreset3, cdPreset4].forEach((btn, idx)=> btn.addEventListener('click', ()=>{ const presets=[60,300,600,1800]; const s = presets[idx]; tHours.value=Math.floor(s/3600); tMinutes.value=Math.floor((s%3600)/60); tSeconds.value=s%60; setCdFromInputs(); }));

    // initialize countdown display
    setCdFromInputs(); cdPause.disabled = true; cdReset.disabled = true;

    // accessibility: keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.code === 'Space' && document.activeElement.tagName !== 'INPUT'){
        e.preventDefault(); if(swRunning) swPause.click(); else swStart.click(); }
      if(e.key === 'l' || e.key === 'L'){ if(!swLap.disabled) swLap.click(); }
    });

  </script>
</body>
</html>
