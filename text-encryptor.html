<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Text Encryptor / Decryptor — Tool i online</title>
  <meta name="description" content="Encrypt and decrypt text locally in your browser. Supports AES-GCM (passphrase-derived), Base64, ROT13 and Caesar cipher. Yellow themed, responsive and professional." />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{ --yellow:#FFB300; --yellow-dark:#d18f00; --bg:#fff9f0; --muted:#6b6b6b; --card:#ffffff; --radius:12px; --shadow:0 14px 40px rgba(0,0,0,0.06); --maxw:1100px }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#111}
    .wrap{max-width:var(--maxw);margin:18px auto;padding:18px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .logo-mark{width:52px;height:52px;border-radius:10px;background:linear-gradient(180deg,var(--yellow),var(--yellow-dark));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    h1{font-size:1.15rem;margin:0}
    p.lead{margin:4px 0 0;color:var(--muted);font-size:0.95rem}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}

    .panel{padding:16px}
    label{display:block;font-size:0.95rem;color:var(--muted);margin-bottom:8px}
    textarea, input, select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:1rem}
    textarea{min-height:180px;resize:vertical}

    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
    .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700;background:#fff;border:1px solid rgba(0,0,0,0.06)}
    .btn.primary{background:var(--yellow);color:#111}
    .btn.ghost{background:#fff}

    .small{font-size:0.9rem;color:var(--muted)}
    .preview{padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);min-height:120px;background:linear-gradient(180deg,#fff,#fffef8);white-space:pre-wrap}

    .meta{display:flex;justify-content:space-between;gap:8px;align-items:center;margin-top:12px}

    .history{max-height:40vh;overflow:auto;margin-top:12px}
    .history-item{padding:8px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.04);margin-bottom:8px}

    @media (max-width:980px){ .grid{grid-template-columns:1fr} .logo-mark{width:44px;height:44px} textarea{min-height:140px} }
    @media (max-width:480px){ h1{font-size:1rem} }

    :focus{outline:3px solid rgba(255,179,0,0.18)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo-mark">Ti</div>
      <div>
        <h1>Text Encryptor / Decryptor</h1>
        <p class="lead">Encrypt or decrypt text locally. Supports secure AES‑GCM (derived from passphrase), Base64, ROT13 and Caesar. Keys never leave your browser.</p>
      </div>
    </header>

    <main class="card">
      <div class="grid">
        <section class="panel">
          <label for="algorithm">Algorithm</label>
          <select id="algorithm" aria-label="Select algorithm">
            <option value="aes">AES‑GCM (secure, needs passphrase)</option>
            <option value="base64">Base64 (encode/decode)</option>
            <option value="rot13">ROT13 (simple)</option>
            <option value="caesar">Caesar cipher (shift)</option>
          </select>

          <div id="passphraseRow" style="margin-top:12px">
            <label for="passphrase">Passphrase (for AES)</label>
            <input id="passphrase" type="password" placeholder="Enter a passphrase (6+ characters)" aria-label="Passphrase">
            <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
              <button id="generateKey" class="btn ghost">Generate Random Key</button>
              <button id="showKey" class="btn ghost">Show Derived Key</button>
              <div style="flex:1"></div>
              <label class="small"><input type="checkbox" id="showPass"> Show passphrase</label>
            </div>
            <div class="small" style="margin-top:8px">Tip: Use a strong unique passphrase. This page performs all operations locally — nothing is sent to a server.</div>
          </div>

          <div id="caesarRow" style="margin-top:12px;display:none">
            <label for="shift">Shift amount (Caesar)</label>
            <input id="shift" type="number" value="3" min="1" max="25">
          </div>

          <div style="margin-top:12px">
            <label for="inputText">Input</label>
            <textarea id="inputText" placeholder="Type or paste text to encrypt/decrypt"></textarea>
          </div>

          <div class="controls">
            <button id="encryptBtn" class="btn primary"><i class="fa-solid fa-lock"></i> Encrypt</button>
            <button id="decryptBtn" class="btn ghost"><i class="fa-solid fa-lock-open"></i> Decrypt</button>
            <button id="copyBtn" class="btn ghost"><i class="fa-solid fa-copy"></i> Copy</button>
            <button id="downloadBtn" class="btn ghost"><i class="fa-solid fa-download"></i> Download</button>
            <div style="flex:1"></div>
            <button id="clearBtn" class="btn ghost">Clear</button>
          </div>

          <div style="margin-top:12px">
            <label for="notes">Notes / Raw output</label>
            <div class="preview" id="preview">Output will appear here</div>
          </div>

        </section>

        <aside class="panel">
          <h3 style="margin-top:0">Extras & History</h3>
          <div class="small">Quick actions</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="importBtn" class="btn ghost">Import (paste JSON)</button>
            <button id="exportBtn" class="btn ghost">Export output</button>
            <button id="clearHistory" class="btn ghost">Clear history</button>
          </div>

          <div style="margin-top:12px">
            <div class="small">Saved outputs (local)</div>
            <div class="history" id="historyList"></div>
          </div>
        </aside>
      </div>
    </main>
  </div>

<script>
// Utilities
function bufToBase64(buf){ const bytes = new Uint8Array(buf); let binary = ''; for(let i=0;i<bytes.byteLength;i++) binary += String.fromCharCode(bytes[i]); return btoa(binary); }
function base64ToBuf(b64){ const binary = atob(b64); const len = binary.length; const bytes = new Uint8Array(len); for(let i=0;i<len;i++) bytes[i] = binary.charCodeAt(i); return bytes.buffer; }
function strToBuf(str){ return new TextEncoder().encode(str); }
function bufToStr(buf){ return new TextDecoder().decode(buf); }
function randomBytes(len){ const b = new Uint8Array(len); crypto.getRandomValues(b); return b; }

// AES-GCM helpers (subtle)
async function deriveKeyFromPassphrase(passphrase, salt){
  const pwKey = await crypto.subtle.importKey('raw', strToBuf(passphrase), 'PBKDF2', false, ['deriveKey']);
  const key = await crypto.subtle.deriveKey({name:'PBKDF2', salt: salt, iterations: 200000, hash:'SHA-256'}, pwKey, {name:'AES-GCM', length:256}, true, ['encrypt','decrypt']);
  return key;
}

async function encryptAES(plaintext, passphrase){
  const salt = randomBytes(16);
  const iv = randomBytes(12);
  const key = await deriveKeyFromPassphrase(passphrase, salt);
  const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, strToBuf(plaintext));
  // package as base64 JSON: {v:'aes-gcm', salt, iv, ct}
  return JSON.stringify({alg:'aes-gcm', salt: bufToBase64(salt), iv: bufToBase64(iv), ct: bufToBase64(ct)});
}

async function decryptAES(payloadJson, passphrase){
  let obj;
  try{ obj = JSON.parse(payloadJson); }catch(e){ throw new Error('Invalid input (not JSON)'); }
  if(obj.alg !== 'aes-gcm') throw new Error('Invalid algorithm marker');
  const salt = base64ToBuf(obj.salt);
  const iv = base64ToBuf(obj.iv);
  const ct = base64ToBuf(obj.ct);
  const key = await deriveKeyFromPassphrase(passphrase, new Uint8Array(salt));
  const pt = await crypto.subtle.decrypt({name:'AES-GCM', iv: new Uint8Array(iv)}, key, ct);
  return bufToStr(pt);
}

// Simple ciphers
function base64Encode(text){ return btoa(unescape(encodeURIComponent(text))); }
function base64Decode(text){ try{ return decodeURIComponent(escape(atob(text))); }catch(e){ throw new Error('Invalid Base64'); } }
function rot13(s){ return s.replace(/[A-Za-z]/g, function(c){ return String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase()<='m' ? 13 : -13)); }); }
function caesar(s, shift){ shift = ((shift % 26) + 26) % 26; return s.replace(/[A-Za-z]/g, function(c){ const base = c <= 'Z' ? 65 : 97; return String.fromCharCode((c.charCodeAt(0)-base+shift)%26 + base); }); }

// UI
const algorithmEl = document.getElementById('algorithm');
const passphraseEl = document.getElementById('passphrase');
const showPassEl = document.getElementById('showPass');
const generateKeyBtn = document.getElementById('generateKey');
const showKeyBtn = document.getElementById('showKey');
const caesarRow = document.getElementById('caesarRow');
const shiftEl = document.getElementById('shift');

const inputTextEl = document.getElementById('inputText');
const encryptBtn = document.getElementById('encryptBtn');
const decryptBtn = document.getElementById('decryptBtn');
const previewEl = document.getElementById('preview');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const clearBtn = document.getElementById('clearBtn');

const importBtn = document.getElementById('importBtn');
const exportBtn = document.getElementById('exportBtn');
const historyList = document.getElementById('historyList');
const clearHistoryBtn = document.getElementById('clearHistory');

const STORAGE = 'ti_encryptor_history_v1';

algorithmEl.addEventListener('change', ()=>{
  const alg = algorithmEl.value;
  document.getElementById('passphraseRow').style.display = (alg === 'aes') ? '' : 'none';
  caesarRow.style.display = (alg === 'caesar') ? '' : 'none';
});

showPassEl.addEventListener('change', ()=>{ passphraseEl.type = showPassEl.checked ? 'text' : 'password'; });

generateKeyBtn.addEventListener('click', ()=>{
  // generate a strong random 32-byte key and show as base64 for user to copy
  const key = randomBytes(32);
  const b64 = bufToBase64(key.buffer);
  alert('Random key (base64) — store it securely:\n\n' + b64);
});

showKeyBtn.addEventListener('click', async ()=>{
  const pass = passphraseEl.value || '';
  if(!pass){ alert('Enter a passphrase first'); return; }
  try{
    const salt = new Uint8Array(16); // deterministic view: showing derived public info is safe-ish but not recommended
    crypto.getRandomValues(salt);
    const key = await deriveKeyFromPassphrase(pass, salt);
    const raw = await crypto.subtle.exportKey('raw', key);
    alert('Derived key (base64) — for debugging only:\n\n' + bufToBase64(raw));
  }catch(e){ alert('Could not derive key: ' + e.message); }
});

async function doEncrypt(){
  const alg = algorithmEl.value;
  const input = inputTextEl.value || '';
  if(!input){ alert('Enter text to encrypt'); return; }
  try{
    if(alg === 'aes'){
      const pass = passphraseEl.value || '';
      if(pass.length < 6) return alert('Passphrase should be at least 6 characters');
      previewEl.textContent = 'Encrypting...';
      const out = await encryptAES(input, pass);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'base64'){
      const out = base64Encode(input);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'rot13'){
      const out = rot13(input);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'caesar'){
      const shift = parseInt(shiftEl.value) || 3;
      const out = caesar(input, shift);
      previewEl.textContent = out;
      saveHistory(out, alg);
    }
  }catch(e){ previewEl.textContent = 'Error: ' + e.message; }
}

async function doDecrypt(){
  const alg = algorithmEl.value;
  const input = inputTextEl.value || '';
  if(!input){ alert('Enter text to decrypt'); return; }
  try{
    if(alg === 'aes'){
      const pass = passphraseEl.value || '';
      if(!pass) return alert('Enter passphrase');
      previewEl.textContent = 'Decrypting...';
      const out = await decryptAES(input, pass);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'base64'){
      const out = base64Decode(input);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'rot13'){
      const out = rot13(input);
      previewEl.textContent = out;
      saveHistory(out, alg);
    } else if(alg === 'caesar'){
      const shift = parseInt(shiftEl.value) || 3;
      const out = caesar(input, 26 - shift); // reverse shift
      previewEl.textContent = out;
      saveHistory(out, alg);
    }
  }catch(e){ previewEl.textContent = 'Error: ' + e.message; }
}

encryptBtn.addEventListener('click', doEncrypt);
decryptBtn.addEventListener('click', doDecrypt);

copyBtn.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(previewEl.textContent || ''); copyBtn.textContent = 'Copied'; setTimeout(()=> copyBtn.innerHTML = '<i class="fa-solid fa-copy"></i> Copy',1000);}catch(e){ alert('Copy failed'); } });

downloadBtn.addEventListener('click', ()=>{ const out = previewEl.textContent || ''; const blob = new Blob([out], {type:'text/plain;charset=utf-8'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'output.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href); });

clearBtn.addEventListener('click', ()=>{ if(!inputTextEl.value && !previewEl.textContent) return; if(!confirm('Clear input and output?')) return; inputTextEl.value = ''; previewEl.textContent = 'Output will appear here'; });

// history management
function saveHistory(text, alg){ try{ const raw = localStorage.getItem(STORAGE); const list = raw ? JSON.parse(raw) : []; list.unshift({ts:Date.now(), alg, text: text.slice(0,200), full: text}); if(list.length>50) list.pop(); localStorage.setItem(STORAGE, JSON.stringify(list)); renderHistory(); }catch(e){} }
function renderHistory(){ const raw = localStorage.getItem(STORAGE); const list = raw ? JSON.parse(raw) : []; historyList.innerHTML = ''; if(!list.length){ historyList.innerHTML = '<div class="small">No saved outputs</div>'; return; } list.forEach((it, idx)=>{ const el = document.createElement('div'); el.className='history-item'; el.innerHTML = `<div style="font-weight:700">${escapeHtml(it.alg)} · ${new Date(it.ts).toLocaleString()}</div><div class="small">${escapeHtml(it.text)}</div>`; el.addEventListener('click', ()=>{ previewEl.textContent = it.full; }); historyList.appendChild(el); }); }

clearHistoryBtn.addEventListener('click', ()=>{ if(confirm('Clear history?')){ localStorage.removeItem(STORAGE); renderHistory(); } });

importBtn.addEventListener('click', ()=>{ const txt = prompt('Paste JSON payload (for AES output or plain text)'); if(!txt) return; previewEl.textContent = txt; });
exportBtn.addEventListener('click', ()=>{ const out = previewEl.textContent || ''; if(!out) return alert('Nothing to export'); const blob = new Blob([out], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'export.txt'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href); });

function escapeHtml(unsafe){ return unsafe.replace(/[&<>\"'`]/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',"'":'&#39;','`':'&#96;'}[m]; }); }

// init
(function init(){ algorithmEl.dispatchEvent(new Event('change')); renderHistory(); previewEl.textContent = 'Output will appear here'; })();

</script>
</body>
</html>
