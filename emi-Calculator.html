<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loan EMI Calculator — Tool i online</title>
  <meta name="description" content="Calculate loan EMI, total interest, amortization schedule and export results. Professional responsive EMI Calculator with purple theme." />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{ --purple:#5E35B1; --purple-600:#4a148c; --bg:#ffffff; --muted:#666; --card-radius:12px; --shadow:0 14px 40px rgba(74,20,140,0.08); --maxw:1100px }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg);color:#111}
    .wrap{max-width:var(--maxw);margin:20px auto;padding:16px}
    header{display:flex;gap:12px;align-items:center;margin-bottom:12px}
    .logo-mark{width:46px;height:46px;border-radius:10px;background:linear-gradient(180deg,var(--purple),var(--purple-600));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800}
    h1{font-size:1.15rem;margin:0}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:0.95rem}

    .card{background:#fff;border-radius:var(--card-radius);box-shadow:var(--shadow);overflow:hidden}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px}

    .form{padding:18px;display:flex;flex-direction:column;gap:12px}
    label{font-size:0.95rem;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    input[type=number], input[type=text], select{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:1rem}
    input[type=range]{width:100%}

    .controls{display:flex;gap:8px;flex-wrap:wrap}
    .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:var(--purple);color:#fff}
    .btn.ghost{background:#fff;border:1px solid rgba(0,0,0,0.06)}

    .result-panel{padding:18px;border-left:1px solid rgba(0,0,0,0.04);display:flex;flex-direction:column;gap:12px}
    .stat{background:#fbf7ff;padding:14px;border-radius:10px;border:1px solid rgba(94,53,177,0.03)}
    .big{font-size:1.6rem;font-weight:800;color:var(--purple-600)}
    .muted{color:var(--muted)}

    .chart{height:180px;background:#fff;border-radius:8px;border:1px solid rgba(0,0,0,0.04);display:flex;align-items:center;justify-content:center}

    .schedule{padding:12px;overflow:auto}
    table{width:100%;border-collapse:collapse;font-size:0.95rem}
    th,td{padding:8px;border-bottom:1px solid rgba(0,0,0,0.04);text-align:right}
    th{background:#faf7ff;text-align:right}

    .small{font-size:0.9rem;color:var(--muted)}

    @media (max-width:980px){ .grid{grid-template-columns:1fr} .result-panel{border-left:none;border-top:1px solid rgba(0,0,0,0.04)} }
    @media (max-width:480px){ .logo-mark{width:40px;height:40px} input[type=number]{width:100%} table{font-size:0.85rem} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo-mark">Ti</div>
      <div>
        <h1>Loan EMI Calculator</h1>
        <p class="lead">Calculate monthly EMI, total interest, amortization schedule and export results. Theme: purple.</p>
      </div>
    </header>

    <main class="card">
      <div class="grid">

        <section class="form" aria-labelledby="form-title">
          <h2 id="form-title" style="margin:0;font-size:1rem">Loan details</h2>

          <div>
            <label for="principal">Loan amount (principal)</label>
            <div class="row" style="margin-top:8px">
              <span class="small" style="margin-right:8px">₹</span>
              <input id="principal" type="number" min="0" step="0.01" placeholder="e.g. 500000" aria-label="Loan amount">
            </div>
          </div>

          <div>
            <label for="annualRate">Annual interest rate (%)</label>
            <div class="row" style="margin-top:8px">
              <input id="annualRate" type="number" min="0" step="0.01" placeholder="e.g. 7.5" aria-label="Annual interest rate">
              <div style="flex:1"></div>
              <input id="rateRange" type="range" min="0" max="30" step="0.01" value="7.5" aria-label="Rate slider">
            </div>
          </div>

          <div>
            <label for="tenureYears">Tenure</label>
            <div class="row" style="margin-top:8px">
              <input id="tenureYears" type="number" min="0" step="1" placeholder="Years" aria-label="Tenure years" style="width:110px">
              <span class="small">years</span>
              <div style="width:12px"></div>
              <input id="tenureMonths" type="number" min="0" max="11" step="1" placeholder="Months" aria-label="Tenure months" style="width:110px">
            </div>
          </div>

          <div>
            <label for="freq">Payment frequency</label>
            <div style="margin-top:8px" class="row">
              <select id="freq"><option value="12">Monthly</option><option value="4">Quarterly</option><option value="1">Yearly</option></select>
              <div style="flex:1"></div>
              <label class="small"><input type="checkbox" id="includeExtra"> Include extra monthly payment</label>
            </div>
            <div id="extraRow" style="display:none;margin-top:8px" class="row">
              <span class="small" style="margin-right:8px">₹</span>
              <input id="extraPayment" type="number" min="0" step="0.01" placeholder="Extra per period" style="width:140px">
            </div>
          </div>

          <div class="controls">
            <button id="calcBtn" class="btn primary"><i class="fa-solid fa-calculator"></i> Calculate EMI</button>
            <button id="resetBtn" class="btn ghost">Reset</button>
            <div style="flex:1"></div>
            <button id="downloadCsv" class="btn ghost"><i class="fa-solid fa-download"></i> Download CSV</button>
            <button id="printBtn" class="btn ghost"><i class="fa-solid fa-print"></i> Print</button>
          </div>

          <div class="small" id="note">EMI calculation is done locally in your browser. No data is uploaded.</div>
        </section>

        <aside class="result-panel" aria-labelledby="result-title">
          <h2 id="result-title" style="margin:0;font-size:1rem">Results</h2>

          <div class="stat">
            <div class="small">Estimated EMI per period</div>
            <div class="big" id="emiValue">₹0.00</div>
          </div>

          <div class="stat">
            <div class="small">Total interest payable</div>
            <div id="totalInterest" class="big">₹0.00</div>
          </div>

          <div class="stat">
            <div class="small">Total payment (principal + interest)</div>
            <div id="totalPayment" class="big">₹0.00</div>
          </div>

          <div>
            <div class="small">Breakdown</div>
            <div class="chart" id="pieChart"> <canvas id="allocChart" width="300" height="160" aria-hidden="true"></canvas> </div>
          </div>

          <div style="margin-top:8px">
            <div class="small">Amortization schedule</div>
            <div class="schedule" id="scheduleWrap" style="max-height:220px;overflow:auto;border-radius:8px;border:1px solid rgba(0,0,0,0.04);padding:8px;background:#fff">
              <table id="scheduleTable" aria-live="polite"><thead><tr><th>Period</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Balance</th></tr></thead><tbody></tbody></table>
            </div>
          </div>
        </aside>

      </div>
    </main>
  </div>

<script>
// Helper functions
function fmt(n){ return '₹' + Number(n).toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2}); }
function round2(v){ return Math.round(v*100)/100; }

// Elements
const principalEl = document.getElementById('principal');
const annualRateEl = document.getElementById('annualRate');
const rateRange = document.getElementById('rateRange');
const tenureYearsEl = document.getElementById('tenureYears');
const tenureMonthsEl = document.getElementById('tenureMonths');
const freqEl = document.getElementById('freq');
const includeExtraEl = document.getElementById('includeExtra');
const extraRow = document.getElementById('extraRow');
const extraPaymentEl = document.getElementById('extraPayment');
const calcBtn = document.getElementById('calcBtn');
const resetBtn = document.getElementById('resetBtn');
const emiValueEl = document.getElementById('emiValue');
const totalInterestEl = document.getElementById('totalInterest');
const totalPaymentEl = document.getElementById('totalPayment');
const scheduleBody = document.querySelector('#scheduleTable tbody');
const downloadCsvBtn = document.getElementById('downloadCsv');
const printBtn = document.getElementById('printBtn');
const allocChart = document.getElementById('allocChart');

// Sync slider
rateRange.addEventListener('input', ()=>{ annualRateEl.value = rateRange.value; });
annualRateEl.addEventListener('input', ()=>{ rateRange.value = annualRateEl.value || 0; });

includeExtraEl.addEventListener('change', ()=>{ extraRow.style.display = includeExtraEl.checked ? '' : 'none'; });

function periodsFromTenure(){
  const years = parseInt(tenureYearsEl.value) || 0;
  const months = parseInt(tenureMonthsEl.value) || 0;
  const freq = parseInt(freqEl.value);
  const totalMonths = years*12 + months;
  // convert months into periods of frequency
  const periods = Math.ceil(totalMonths / (12/freq));
  return Math.max(0, periods);
}

function calculateEMI(){
  const P = parseFloat(principalEl.value) || 0;
  const annual = parseFloat(annualRateEl.value) || 0;
  const freq = parseInt(freqEl.value) || 12; // payments per year
  const periods = periodsFromTenure();
  if(P <= 0 || annual < 0 || periods <=0){ alert('Please enter valid loan amount, rate, and tenure.'); return null; }

  // periodic rate
  const r = annual/100 / freq;
  const n = periods;
  let emi = 0;
  if(r === 0){ emi = P / n; }
  else{ emi = P * r * Math.pow(1+r, n) / (Math.pow(1+r, n)-1); }

  // include extra per period
  const extra = includeExtraEl.checked ? (parseFloat(extraPaymentEl.value) || 0) : 0;
  const paymentPerPeriod = emi + extra;

  // build amortization schedule
  let balance = P;
  const schedule = [];
  let totalInterest = 0;
  for(let i=1;i<=n;i++){
    const interest = balance * r;
    let principalPortion = paymentPerPeriod - interest;
    // last payment correction
    if(principalPortion > balance){ principalPortion = balance; }
    const payment = principalPortion + interest;
    balance = round2(balance - principalPortion);
    totalInterest += interest;
    schedule.push({period:i, payment:round2(payment), principal:round2(principalPortion), interest:round2(interest), balance: balance < 0.01 ? 0 : round2(balance)});
    if(balance <= 0) break;
  }

  const totalPayment = schedule.reduce((s, x)=> s + x.payment, 0);

  return {emi: round2(emi), paymentPerPeriod: round2(paymentPerPeriod), totalInterest: round2(totalInterest), totalPayment: round2(totalPayment), schedule};
}

function renderResults(res){
  if(!res){ emiValueEl.textContent = '₹0.00'; totalInterestEl.textContent = '₹0.00'; totalPaymentEl.textContent = '₹0.00'; scheduleBody.innerHTML = ''; drawChart(0,0); return; }
  emiValueEl.textContent = fmt(res.paymentPerPeriod);
  totalInterestEl.textContent = fmt(res.totalInterest);
  totalPaymentEl.textContent = fmt(res.totalPayment);

  // render table (show first 200 rows for performance)
  scheduleBody.innerHTML = '';
  res.schedule.forEach(row =>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td style="text-align:right">${row.period}</td><td>${fmt(row.payment)}</td><td>${fmt(row.principal)}</td><td>${fmt(row.interest)}</td><td>${fmt(row.balance)}</td>`;
    scheduleBody.appendChild(tr);
  });

  drawChart(res.totalPayment - res.totalInterest, res.totalInterest);
}

function drawChart(principalAmt, interestAmt){
  const ctx = allocChart.getContext('2d');
  const w = allocChart.width; const h = allocChart.height; ctx.clearRect(0,0,w,h);
  const total = principalAmt + interestAmt; if(total <= 0) return;
  const pW = Math.round((principalAmt/total) * (w-40));
  const iW = (w-40) - pW;
  // draw legend
  ctx.font = '14px Inter, Arial';
  // principal bar
  ctx.fillStyle = '#8e24aa'; ctx.fillRect(20, 60, pW, 30);
  ctx.fillStyle = '#5E35B1'; ctx.fillRect(20 + pW, 60, iW, 30);
  // labels
  ctx.fillStyle = '#111'; ctx.fillText('Principal: ' + fmt(principalAmt), 20, 50);
  ctx.fillStyle = '#111'; ctx.fillText('Interest: ' + fmt(interestAmt), 20, 110);
}

calcBtn.addEventListener('click', ()=>{
  const res = calculateEMI();
  if(!res) return;
  renderResults(res);
});

resetBtn.addEventListener('click', ()=>{
  principalEl.value = annualRateEl.value = tenureYearsEl.value = tenureMonthsEl.value = extraPaymentEl.value = '';
  freqEl.value = '12'; includeExtraEl.checked = false; extraRow.style.display = 'none'; rateRange.value = 7.5; annualRateEl.value = 7.5;
  renderResults(null);
});

// CSV download
downloadCsvBtn.addEventListener('click', ()=>{
  const res = calculateEMI(); if(!res) return;
  const rows = [['Period','Payment','Principal','Interest','Balance']];
  res.schedule.forEach(r => rows.push([r.period, r.payment, r.principal, r.interest, r.balance]));
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'amortization.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href);
});

printBtn.addEventListener('click', ()=>{
  window.print();
});

// small accessibility: Enter to calculate
[principalEl, annualRateEl, tenureYearsEl, tenureMonthsEl, extraPaymentEl].forEach(el => el && el.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') calcBtn.click(); }));

// initial draw
renderResults(null);

</script>
</body>
</html>
