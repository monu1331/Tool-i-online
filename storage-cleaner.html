<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local Storage Cleaner & Viewer — Tool i online</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{ --orange:#FB8C00; --muted:#666; --bg:#fff; --radius:12px; --shadow:0 12px 30px rgba(0,0,0,0.06); --container:1100px }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;background:linear-gradient(180deg,#fff,#fcfcfc);color:#222;padding:18px}
    .wrap{max-width:var(--container);margin:0 auto}
    header{display:flex;gap:12px;align-items:center;margin-bottom:16px}
    .logo{width:56px;height:56px;border-radius:12px;background:var(--orange);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;box-shadow:var(--shadow)}
    h1{margin:0;font-size:20px}
    .lead{color:var(--muted);font-size:14px;margin-top:4px}

    .card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:16px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;align-items:start}

    .controls{display:flex;flex-direction:column;gap:12px}
    .row{display:flex;gap:8px;align-items:center}
    input[type=text], textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid #eee}
    button{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn{background:var(--orange);color:#fff}
    .btn.ghost{background:#fff;border:1px solid #eee;color:#222}
    .muted{color:var(--muted);font-size:13px}

    .ks{display:flex;gap:8px;align-items:center}
    .ks .badge{background:#f6f6f6;padding:6px 8px;border-radius:8px;border:1px solid #f0f0f0;font-family:monospace}

    .list{max-height:520px;overflow:auto;border-radius:8px;border:1px solid #f0f0f0}
    .item{display:flex;justify-content:space-between;gap:8px;padding:10px;border-bottom:1px dashed #f5f5f5;align-items:center}
    .item:last-child{border-bottom:none}
    .key{font-weight:700}
    .val{color:var(--muted);font-size:13px;max-width:60%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .meta{font-size:12px;color:#999}

    .editor{display:flex;flex-direction:column;gap:8px}
    textarea{min-height:160px;font-family:monospace}

    .search{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}

    @media(max-width:980px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">Ti</div>
      <div>
        <h1>Local Storage Cleaner & Viewer</h1>
        <div class="lead">Inspect, edit, export, and clean browser localStorage for this origin. Orange themed, responsive, and client-side only.</div>
      </div>
    </header>

    <main class="card">
      <div class="grid">
        <section>
          <div class="controls">
            <div class="row">
              <div style="flex:1">
                <label class="muted">Search keys / values</label>
                <input id="searchInput" type="text" placeholder="Filter by key or value...">
              </div>
              <div style="width:120px">
                <label class="muted">Sort</label>
                <select id="sortSelect">
                  <option value="key_asc">Key ↑</option>
                  <option value="key_desc">Key ↓</option>
                  <option value="size_desc">Size ↓</option>
                  <option value="size_asc">Size ↑</option>
                </select>
              </div>
            </div>

            <div class="ks">
              <div class="small">Items</div>
              <div class="badge" id="countBadge">0</div>
              <div style="flex:1"></div>
              <button id="reloadBtn" class="btn ghost">Reload</button>
              <button id="clearAllBtn" class="btn ghost">Clear All</button>
            </div>

            <div class="list card" id="list"></div>

            <div class="row">
              <button id="exportBtn" class="btn ghost">Export JSON</button>
              <label class="ghost" style="padding:10px;border-radius:10px;border:1px dashed #eee;cursor:pointer"><input id="importFile" type="file" accept="application/json" style="display:none"> Import JSON</label>
              <button id="downloadZipBtn" class="btn ghost">Download .zip (keys)</button>
            </div>

            <div class="small">Note: This tool only reads/writes localStorage for the current origin. Clearing will remove items permanently for this site.</div>
          </div>
        </section>

        <aside>
          <div class="editor card">
            <div class="small">Selected item</div>
            <div class="muted" id="selKey">(none)</div>
            <textarea id="valueEditor" placeholder="Select an item to view/edit its value"></textarea>
            <div style="display:flex;gap:8px">
              <button id="saveBtn" class="btn ghost" disabled>Save</button>
              <button id="deleteBtn" class="btn ghost" disabled>Delete</button>
              <button id="prettyBtn" class="btn ghost" disabled>Pretty JSON</button>
            </div>
            <div style="height:8px"></div>
            <div class="small">Quick actions</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
              <button id="setExample" class="btn ghost">Set Example Key</button>
              <button id="clearSelectedBtn" class="btn ghost">Clear Selected</button>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <script>
    // Helper: human-readable size
    function bytesLen(s){ try{ return new Blob([s]).size; }catch(e){ return s.length; } }
    function formatBytes(n){ if(n<1024) return n+' B'; if(n<1024*1024) return (n/1024).toFixed(2)+' KB'; return (n/1024/1024).toFixed(2)+' MB'; }

    const listEl = document.getElementById('list');
    const countBadge = document.getElementById('countBadge');
    const searchInput = document.getElementById('searchInput');
    const sortSelect = document.getElementById('sortSelect');
    const reloadBtn = document.getElementById('reloadBtn');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');
    const valueEditor = document.getElementById('valueEditor');
    const selKeyEl = document.getElementById('selKey');
    const saveBtn = document.getElementById('saveBtn');
    const deleteBtn = document.getElementById('deleteBtn');
    const prettyBtn = document.getElementById('prettyBtn');
    const setExample = document.getElementById('setExample');
    const clearSelectedBtn = document.getElementById('clearSelectedBtn');
    const downloadZipBtn = document.getElementById('downloadZipBtn');

    let items = []; let selectedKey = null;

    function loadItems(){ items = []; for(let i=0;i<localStorage.length;i++){ const k = localStorage.key(i); const v = localStorage.getItem(k); items.push({key:k, value:v, size: bytesLen(v)}); } renderList(); }

    function renderList(){ const q = searchInput.value.trim().toLowerCase(); let out = items.slice(); // filter
      if(q){ out = out.filter(it => it.key.toLowerCase().includes(q) || (it.value && it.value.toLowerCase().includes(q))); }
      // sort
      const sort = sortSelect.value;
      if(sort==='key_asc') out.sort((a,b)=> a.key.localeCompare(b.key));
      if(sort==='key_desc') out.sort((a,b)=> b.key.localeCompare(a.key));
      if(sort==='size_desc') out.sort((a,b)=> b.size - a.size);
      if(sort==='size_asc') out.sort((a,b)=> a.size - b.size);

      listEl.innerHTML=''; out.forEach(it=>{ const div = document.createElement('div'); div.className='item'; div.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center;min-width:0">
          <div>
            <div class="key">${escapeHtml(it.key)}</div>
            <div class="meta">${formatBytes(it.size)}</div>
          </div>
          <div class="val" title="${escapeHtml(it.value)}">${escapeHtml(it.value)}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn ghost" data-key="${encodeURIComponent(it.key)}" data-action="view">View</button>
          <button class="btn ghost" data-key="${encodeURIComponent(it.key)}" data-action="delete">Delete</button>
        </div>
      `; listEl.appendChild(div); });
      countBadge.textContent = items.length;
    }

    function escapeHtml(s){ if(!s) return ''; return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

    listEl.addEventListener('click', e=>{
      const btn = e.target.closest('button'); if(!btn) return; const action = btn.dataset.action; const key = decodeURIComponent(btn.dataset.key);
      if(action === 'view'){ selectKey(key); }
      if(action === 'delete'){ if(confirm('Delete key "'+key+'" permanently?')){ localStorage.removeItem(key); loadItems(); if(selectedKey===key){ clearSelection(); } } }
    });

    function selectKey(key){ selectedKey = key; selKeyEl.textContent = key; const v = localStorage.getItem(key); valueEditor.value = v === null ? '' : v; saveBtn.disabled = false; deleteBtn.disabled = false; prettyBtn.disabled = false; }
    function clearSelection(){ selectedKey = null; selKeyEl.textContent='(none)'; valueEditor.value=''; saveBtn.disabled = true; deleteBtn.disabled = true; prettyBtn.disabled = true; }

    saveBtn.addEventListener('click', ()=>{
      if(!selectedKey) return; const newVal = valueEditor.value; try{ localStorage.setItem(selectedKey, newVal); alert('Saved.'); loadItems(); }catch(e){ alert('Save failed: '+e.message); }
    });

    deleteBtn.addEventListener('click', ()=>{ if(!selectedKey) return; if(confirm('Delete key "'+selectedKey+'" permanently?')){ localStorage.removeItem(selectedKey); loadItems(); clearSelection(); } });

    prettyBtn.addEventListener('click', ()=>{
      try{ const parsed = JSON.parse(valueEditor.value); valueEditor.value = JSON.stringify(parsed, null, 2); }catch(e){ alert('Not valid JSON'); }
    });

    reloadBtn.addEventListener('click', ()=>{ loadItems(); clearSelection(); });

    clearAllBtn.addEventListener('click', ()=>{ if(confirm('Clear ALL localStorage for this origin? This cannot be undone.')){ localStorage.clear(); loadItems(); clearSelection(); } });

    exportBtn.addEventListener('click', ()=>{
      const obj = {}; items.forEach(it=> obj[it.key] = it.value);
      const blob = new Blob([JSON.stringify(obj, null, 2)], {type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'localstorage-'+location.hostname+'.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),5000);
    });

    importFile.addEventListener('change', e=>{
      const f = e.target.files && e.target.files[0]; if(!f) return; const reader = new FileReader(); reader.onload = ()=>{
        try{ const obj = JSON.parse(reader.result); if(typeof obj !== 'object' || obj===null){ alert('Invalid JSON'); return; }
          if(confirm('This will import keys and overwrite existing keys with same names. Continue?')){
            Object.keys(obj).forEach(k=>{ localStorage.setItem(k, String(obj[k])); }); loadItems(); alert('Import complete'); }
        }catch(err){ alert('Failed to parse JSON: '+err.message); }
      }; reader.readAsText(f);
    });

    setExample.addEventListener('click', ()=>{ localStorage.setItem('example_user','{"name":"Jane","role":"tester","lastLogin":"2025-11-16T00:00:00Z"}'); loadItems(); alert('Example key set.'); });

    clearSelectedBtn.addEventListener('click', ()=>{ if(!selectedKey) return; if(confirm('Clear value for "'+selectedKey+'" (keeps key)?')){ localStorage.setItem(selectedKey, ''); loadItems(); selectKey(selectedKey); } });

    // download zip of each key as separate file (uses JSZip if available, else export JSON)
    downloadZipBtn.addEventListener('click', async ()=>{
      if(window.JSZip){ const zip = new JSZip(); items.forEach(it=> zip.file(safeFilename(it.key)+'.txt', it.value||'')); const content = await zip.generateAsync({type:'blob'}); const url = URL.createObjectURL(content); const a = document.createElement('a'); a.href = url; a.download = 'localstorage-'+location.hostname+'.zip'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),5000); } else { alert('JSZip not loaded — exporting JSON instead.'); exportBtn.click(); } });

    function safeFilename(s){ return s.replace(/[^a-z0-9-_\.]/ig,'_').slice(0,120); }

    // search / sort events
    searchInput.addEventListener('input', ()=> renderList());
    sortSelect.addEventListener('change', ()=> renderList());

    // initial load
    loadItems(); clearSelection();

    // expose utility for dev console
    window._ls = { reload: loadItems, clear: ()=>localStorage.clear(), items: ()=>items };
  </script>
</body>
</html>
